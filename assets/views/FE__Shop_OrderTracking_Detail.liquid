{% assign order = Model.Data %}
{% assign oldStatus = order.OrderHistories[order.OrderHistories.size - 1].OldValue %}
{% assign status = order.Status %}

<div class="w-full xl:mx-auto xl:max-w-7xl">
  <div class="flex flex-col gap-y-4 xl:items-center w-full px-6 py-5 md:py-10 2xl:px-0">
    <div class="w-full border-b border-neutral-2-200 pb-4 flex flex-col gap-y-3 md:flex-row md:justify-between">
      <button class="flex justify-between items-center">
        {% a controller: "Order", action: "OrderTracking", route_area: "TWeb.Products", class: "text-neutral-1-700 flex gap-2 border border-neutral-2-200 rounded-full p-2" %}
          <i class="twi-17-arrow-narrow-left-fill text-neutral-1-500 text-xl leading-none"></i>
          <p class="text-body-2">Quay lại</p>
        {% enda %}
      </button>
      <div class="flex items-center justify-between gap-x-5 md:justify-end md:gap-x-4">
        <p class="text-neutral-1-900 bg-neutral-3-50 rounded-[4px] text-body-2 py-1 px-3">Mã đơn hàng:
          <span class="font-medium">{{ order.Code | raw }}</span>
        </p>
        <div class="p-2 rounded-[4px] bg-status">
          <p class="text-status text-body-2 text-white"></p>
        </div>
      </div>
    </div>

    <div class="w-full px-4 md:px-0 md:flex md:justify-between xl:justify-center xl:items-start max-w-[820px]">
      <div class="order-tracking">
        <span class="line"></span>
        <div class="w-full flex md:items-center xl:justify-center">
          <span class="dot border-neutral-2-200 mb-[54px] md:mb-0"></span>
          <div class="pt-2 md:pt-0 xl:relative">
            <p class="text-neutral-1-900 font-medium text-body-1 xl:truncate xl:absolute xl:-left-20">Xác nhận <br class="hidden md:block xl:hidden"> đặt hàng</p>
          </div>
        </div>
      </div>
      <div class="order-tracking">
        <span class="line"></span>
        <div class=" flex md:items-center">
          <span class="dot border-neutral-2-200 mb-[54px] md:mb-0"></span>
          <div class="pt-2 md:pt-0">
            <p class="text-neutral-1-900 font-medium text-body-1">Xử lý đơn hàng</p>
          </div>
        </div>
      </div>
      <div class="order-tracking">
        <div class="w-full flex md:items-center">
          <span class="dot border-neutral-2-200"></span>
          <div class="pt-2 md:pt-0">
            <p class="text-neutral-1-900 font-medium text-body-1 truncate">Đang giao</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>


{% scriptblock depends_on: "jQuery", at: "Foot" %}
  const status = '{{ status }}';
  const statusArr = ['Pending', 'InProgress', 'Delivering'];
                                                          const oldStatus = '{{ oldStatus }}';
  const orderTrackingLst = document.querySelectorAll('.order-tracking');
                                                          const text = document.querySelector('.text-status');
                                                          const bgStatus = document.querySelector('.bg-status');
                                                          switch (status) {
                                                            case 'Pending':
                                                              bgStatus.classList.add('status-Yellow');
                                                              text.classList.add('status-Yellow');
                                                              text.innerHTML = "Chờ xác nhận"
                                                              for(let i = 0; i >= 0; i--){
                                                                const isComplete = orderTrackingLst[i].querySelector('.dot');
                                                                const isLine = orderTrackingLst[i].querySelector('.line');
                                                                isLine.classList.add('line-green')
                                                                isComplete.classList.replace('border-neutral-2-200', 'border-primary-1' )
                                                              }
                                                            break;
                                                          
                                                            case 'InProgress':
                                                              bgStatus.classList.add('status-blue');
                                                              text.classList.add('status-blue')
                                                              text.innerHTML = "Đang xử lí"
                                                            for (let i = 0; i >= 0 ; i--) {
                                                                const isLine = orderTrackingLst[i].querySelector('.line');
                                                                const isComplete = orderTrackingLst[i].querySelector('.dot');
                                                                isComplete.classList.add('completed')
                                                                isLine.classList.add('line-green')
                                                            };
                                                            for (let i = 1; i >= 0 ; i--) {
                                                                const isComplete = orderTrackingLst[i].querySelector('.dot');
                                                                isComplete.classList.replace('border-neutral-2-200', 'border-primary-1' )
                                                            };
                                                            break;
                                                          
                                                            case 'Delivering':
                                                              bgStatus.classList.add('status-blue');
                                                              text.classList.add('status-blue')
                                                              text.innerHTML = "Đang giao"
                                                            for (let i = 1; i >= 0 ; i--) {
                                                              const isLine = orderTrackingLst[i].querySelector('.line');
                                                              const isComplete = orderTrackingLst[i].querySelector('.dot');
                                                              isComplete.classList.add('completed')
                                                              isLine.classList.add('line-green')
                                                            };
                                                            for (let i = 2; i >= 0 ; i--) {
                                                              const isComplete = orderTrackingLst[i].querySelector('.dot');
                                                              isComplete.classList.replace('border-neutral-2-200', 'border-primary-1' )
                                                            };
                                                           
                                                            break;
                                                            case 'Complete':
                                                            bgStatus.classList.add('status-green');
                                                            text.classList.add('status-green')
                                                            text.innerHTML = "Hoàn thành"
                                                            for (let i = 1; i >= 0 ; i--) {
                                                              const isLine = orderTrackingLst[i].querySelector('.line');
                                                              isLine.classList.add('line-green')
                                                            };
                                                            for (let i = 2; i >= 0 ; i--) {
                                                              const isComplete = orderTrackingLst[i].querySelector('.dot');
                                                              isComplete.classList.add('completed')
                                                            };
                                                            break;
                                                          
                                                            case 'Canceled':
                                                            
                                                              bgStatus.classList.add('status-red');
                                                              text.classList.add('status-red')
                                                              text.innerHTML = "Đã hủy";
                                                              const indexOlaStatus = statusArr.findIndex(stt => stt == oldStatus);
                                                            for (let i = 0; i < indexOlaStatus + 1; i++) {
                                                              const isline = orderTrackingLst[i].querySelector('.line');
                                                              const isComplete = orderTrackingLst[i].querySelector('.dot');
                                                                if(i < indexOlaStatus){
                                                                  isComplete.classList.add('completed')
                                                                  isline.classList.add('line-green')
                                                                }
                                                                else{
                                                                  isComplete.classList.add('cancel')
                                                                  isline.classList.add('line-red')
                                                                  orderTrackingLst[2].classList.add('border-error-400')
                                                                }
                                                            };
                                                            break;
                                                        
                                                            default:
                                                            text.classList.add('status-Yellow');
                                                        }{% endscriptblock %}